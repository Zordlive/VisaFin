# ğŸ¨ Diagramme du Flux - Notifications Admin InstantanÃ©es

## Architecture Globale

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            UTILISATEUR                                      â”‚
â”‚                                                                             â”‚
â”‚  Page: /deposits   ou   Page: /withdraw                                    â”‚
â”‚                                                                             â”‚
â”‚  Remplir le formulaire                                                     â”‚
â”‚  â””â”€ Montant, MÃ©thode (pour dÃ©pÃ´t)                                         â”‚
â”‚  â””â”€ Montant, Banque, Compte (pour retrait)                                â”‚
â”‚                                                                             â”‚
â”‚  Clicker: "Effectuer le dÃ©pÃ´t" ou "Effectuer le retrait"                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ POST /api/deposits/initiate (DÃ©pÃ´t)
                           â”‚ ou
                           â”‚ POST /api/withdrawals/ (Retrait)
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          API BACKEND                                        â”‚
â”‚                                                                             â”‚
â”‚  DepositViewSet.initiate()        OU        WithdrawalViewSet.create()     â”‚
â”‚         â”‚                                              â”‚                    â”‚
â”‚         â”œâ”€ CrÃ©er: Deposit(...)                        â”œâ”€ CrÃ©er: Withdrawal(...)
â”‚         â”‚         âœ“ user = utilisateur                â”‚         âœ“ user = utilisateur
â”‚         â”‚         âœ“ amount = montant                  â”‚         âœ“ amount = montant
â”‚         â”‚         âœ“ currency = devise                 â”‚         âœ“ bank = banque
â”‚         â”‚         âœ“ status = 'pending'                â”‚         âœ“ account = compte
â”‚         â”‚                                             â”‚         âœ“ status = 'pending'
â”‚         â”‚                                             â”‚
â”‚         â”œâ”€ CrÃ©er: AdminNotification(...) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€ perform_create() appelle aussi:
â”‚         â”‚  â”‚      âœ“ admin = superuser                â”‚   â””â”€ CrÃ©er: AdminNotification(...)
â”‚         â”‚  â”‚      âœ“ user = utilisateur                â”‚      âœ“ admin = superuser
â”‚         â”‚  â”‚      âœ“ notification_type = 'deposit'    â”‚      âœ“ user = utilisateur
â”‚         â”‚  â”‚      âœ“ amount = montant                 â”‚      âœ“ notification_type = 'withdrawal'
â”‚         â”‚  â”‚      âœ“ account_info = dÃ©tails           â”‚      âœ“ amount = montant
â”‚         â”‚  â”‚      âœ“ is_read = False                  â”‚      âœ“ account_info = "bank - account"
â”‚         â”‚  â”‚      âœ“ deposit = dÃ©pÃ´t crÃ©Ã©             â”‚      âœ“ is_read = False
â”‚         â”‚  â”‚                                         â”‚      âœ“ withdrawal = retrait crÃ©Ã©
â”‚         â”‚  â””â”€ âœ¨ NOTIFICATION CRÃ‰Ã‰E âœ¨              â”‚      â””â”€ âœ¨ NOTIFICATION CRÃ‰Ã‰E âœ¨
â”‚         â”‚
â”‚         â””â”€ Retourner: { deposit_id, instructions, status }
â”‚                    ou
â”‚            { id, user, amount, bank, account, status, ... }
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ RÃ©ponse + Sauvegarde dans DB
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DATABASE                                           â”‚
â”‚                                                                             â”‚
â”‚  Table: api_deposit                                                        â”‚
â”‚  â”œâ”€ id: 1                                                                  â”‚
â”‚  â”œâ”€ user_id: 5                                                             â”‚
â”‚  â”œâ”€ amount: 100                                                            â”‚
â”‚  â”œâ”€ status: 'pending'                                                      â”‚
â”‚  â””â”€ created_at: 2024-01-30 14:00:05                                       â”‚
â”‚                                                                             â”‚
â”‚  Table: api_withdrawal                                                     â”‚
â”‚  â”œâ”€ id: 1                                                                  â”‚
â”‚  â”œâ”€ user_id: 5                                                             â”‚
â”‚  â”œâ”€ amount: 50                                                             â”‚
â”‚  â”œâ”€ bank: 'Orange Monnaie'                                                â”‚
â”‚  â”œâ”€ account: '0971234567'                                                 â”‚
â”‚  â”œâ”€ status: 'pending'                                                      â”‚
â”‚  â””â”€ created_at: 2024-01-30 14:00:05                                       â”‚
â”‚                                                                             â”‚
â”‚  Table: api_adminnotification  â—„â”€â”€â”€â”€â”€â”€ CLLEMENT CLÃ‰                       â”‚
â”‚  â”œâ”€ id: 1                                                                  â”‚
â”‚  â”œâ”€ admin_id: 1 (superuser)                                               â”‚
â”‚  â”œâ”€ user_id: 5 (utilisateur)                                              â”‚
â”‚  â”œâ”€ notification_type: 'deposit' ou 'withdrawal'                          â”‚
â”‚  â”œâ”€ amount: 100 ou 50                                                      â”‚
â”‚  â”œâ”€ account_info: 'DÃ©pÃ´t via Orange Money' ou 'Orange Monnaie - 0971...' â”‚
â”‚  â”œâ”€ is_read: False                                                         â”‚
â”‚  â”œâ”€ deposit_id: 1 (pour dÃ©pÃ´ts)                                           â”‚
â”‚  â”œâ”€ withdrawal_id: 1 (pour retraits)                                      â”‚
â”‚  â””â”€ created_at: 2024-01-30 14:00:05                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Frontend rafraÃ®chit automatiquement
                           â”‚ (toutes les 10 secondes)
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ADMIN DASHBOARD                                     â”‚
â”‚                          (/admin)                                           â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Tableau de Bord Admin                              [â† Retour]      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  [Notifications] [Retraits Ã  Traiter]                              â”‚   â”‚
â”‚  â”‚          â”Œâ”€â–º Badge: 1 notification non lue                         â”‚   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ ğŸŸ¢ DÃ‰PÃ”T - 100 USD                                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ user@example.com (+237697654321)                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Compte: DÃ©pÃ´t via Orange Money                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 2024-01-30 14:00:05                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â— Non lue                                                    â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚  (Cliquer pour marquer comme lue)                                 â”‚   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ ğŸ”´ RETRAIT - 50 USD                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ user@example.com (+237697654321)                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Compte: Orange Monnaie - 0971234567                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ 2024-01-30 14:00:05                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ â³ Pending                                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ [Traiter] â—„â”€â”€â”€â”€â”€â”€ Bouton pour approuver/rejeter              â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚  (Cliquer pour ouvrir le modal)                                   â”‚   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ MODAL: Traiter le Retrait                                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Utilisateur: user@example.com                               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Montant: 50 USD                                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Banque: Orange Monnaie                                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Compte: 0971234567                                          â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Action: [SÃ©lectionner une action â–¼]                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚         - Approuver                                         â”‚ â”‚   â”‚
â”‚  â”‚  â”‚         - Rejeter (+ raison)                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ [Annuler] [Confirmer]                                       â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    (Si admin traite)
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TRAITEMENT DU RETRAIT                                    â”‚
â”‚                                                                             â”‚
â”‚  POST /api/withdrawals/{id}/process/                                       â”‚
â”‚  Payload: {                                                                 â”‚
â”‚      action: 'complete' ou 'reject',                                       â”‚
â”‚      reason: 'Compte invalide' (si reject)                                â”‚
â”‚  }                                                                          â”‚
â”‚                                                                             â”‚
â”‚  Backend met Ã  jour:                                                       â”‚
â”‚  â”œâ”€ Withdrawal.status = 'completed' ou 'rejected'                          â”‚
â”‚  â”œâ”€ Withdrawal.processed_by = admin                                        â”‚
â”‚  â””â”€ Withdrawal.processed_at = maintenant                                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATABASE MISE Ã€ JOUR                                   â”‚
â”‚                                                                             â”‚
â”‚  Table: api_withdrawal                                                     â”‚
â”‚  â”œâ”€ status: 'completed' âœ“  ou  'rejected' âœ—                               â”‚
â”‚  â”œâ”€ processed_by_id: 1 (admin)                                            â”‚
â”‚  â”œâ”€ processed_at: 2024-01-30 14:05:30                                    â”‚
â”‚  â””â”€ reason_rejected: 'Compte invalide' (si reject)                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    Frontend rafraÃ®chit
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ADMIN DASHBOARD MIS Ã€ JOUR                          â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸŸ¢ RETRAIT - 50 USD                                                 â”‚   â”‚
â”‚  â”‚ user@example.com                                                    â”‚   â”‚
â”‚  â”‚ Compte: Orange Monnaie - 0971234567                                â”‚   â”‚
â”‚  â”‚ âœ“ Completed (TraitÃ© le 2024-01-30 14:05:30)                       â”‚   â”‚
â”‚  â”‚ Processed by: Admin User                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  OU                                                                         â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âŒ RETRAIT - 50 USD                                                  â”‚   â”‚
â”‚  â”‚ user@example.com                                                    â”‚   â”‚
â”‚  â”‚ Compte: Orange Monnaie - 0971234567                                â”‚   â”‚
â”‚  â”‚ âœ— Rejected (Compte invalide)                                        â”‚   â”‚
â”‚  â”‚ Processed by: Admin User                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ã‰tat-Transitions Retrait

```
Ã‰tat initial:      pending
                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                 â”‚
        approve           reject + reason
              â”‚                 â”‚
              â–¼                 â–¼
          completed            rejected
              â”‚                 â”‚
         âœ“ Complet      âœ— Non complÃ©tÃ©
         TraitÃ© par      Raison fournie
         Admin           Raison stockÃ©e
         Ã€: 14:05:30    Ã€: 14:05:30
```

---

## Flux de DonnÃ©es API

```
REQUEST (Utilisateur â†’ Backend)
â”œâ”€ POST /api/deposits/initiate
â”‚  â””â”€ { amount, method, currency }
â”‚
â”œâ”€ POST /api/withdrawals/
â”‚  â””â”€ { amount, bank, account, status='pending' }
â”‚
â”œâ”€ GET /api/admin-notifications/
â”‚  â””â”€ Aucun paramÃ¨tre (Admin seulement)
â”‚
â”œâ”€ POST /api/admin-notifications/{id}/mark_as_read/
â”‚  â””â”€ Aucun paramÃ¨tre
â”‚
â””â”€ POST /api/withdrawals/{id}/process/
   â””â”€ { action, reason (optionnel) }

RESPONSE (Backend â†’ Frontend)
â”œâ”€ DepositViewSet.initiate()
â”‚  â””â”€ { deposit_id, instructions, status }
â”‚
â”œâ”€ WithdrawalViewSet.create()
â”‚  â””â”€ { id, user, amount, bank, account, status, ... }
â”‚
â”œâ”€ AdminNotificationViewSet.list()
â”‚  â””â”€ { count, results: [ { id, user, notification_type, ... } ] }
â”‚
â””â”€ WithdrawalViewSet.process()
   â””â”€ { message: "Retrait complÃ©tÃ©" ou "Retrait rejetÃ©" }

SIDE EFFECT (Database)
â”œâ”€ DepositViewSet.initiate()
â”‚  â”œâ”€ Create Deposit
â”‚  â””â”€ Create AdminNotification (type='deposit')
â”‚
â”œâ”€ WithdrawalViewSet.perform_create()
â”‚  â”œâ”€ Create Withdrawal
â”‚  â””â”€ Create AdminNotification (type='withdrawal')
â”‚
â”œâ”€ AdminNotificationViewSet.mark_as_read()
â”‚  â””â”€ Update AdminNotification.is_read = True
â”‚
â””â”€ WithdrawalViewSet.process()
   â””â”€ Update Withdrawal.status, processed_by, processed_at, reason_rejected
```

---

## Timeline d'une Transaction ComplÃ¨te

```
14:00:00 â”‚ Utilisateur clique sur "Effectuer le retrait"
         â”‚
14:00:01 â”‚ Frontend envoie POST /api/withdrawals/
         â”‚
14:00:02 â”‚ Backend:
         â”‚ â”œâ”€ CrÃ©e Withdrawal (status='pending')
         â”‚ â””â”€ CrÃ©e AdminNotification (is_read=False)
         â”‚
14:00:03 â”‚ Frontend affiche "Retrait effectuÃ©"
         â”‚
14:00:05 â”‚ Admin ouvre http://localhost:5173/admin
         â”‚
14:00:10 â”‚ Frontend rafraÃ®chit (auto)
         â”‚ â”œâ”€ GET /api/admin-notifications/
         â”‚ â””â”€ Affiche la nouvelle notification
         â”‚
14:00:15 â”‚ Admin voit la notification
         â”‚ â”œâ”€ Badges de compteur: 1 notification non lue
         â”‚ â””â”€ Couleur rouge pour retrait (pending)
         â”‚
14:00:20 â”‚ Admin clique sur le retrait
         â”‚
14:00:21 â”‚ Modal s'ouvre avec dÃ©tails
         â”‚
14:00:30 â”‚ Admin sÃ©lectionne "Approuver"
         â”‚
14:00:31 â”‚ Admin clique "Confirmer"
         â”‚
14:00:32 â”‚ Frontend envoie POST /api/withdrawals/1/process/
         â”‚           { action: 'complete' }
         â”‚
14:00:33 â”‚ Backend:
         â”‚ â”œâ”€ Withdrawal.status = 'completed'
         â”‚ â”œâ”€ Withdrawal.processed_by = admin
         â”‚ â””â”€ Withdrawal.processed_at = 14:00:33
         â”‚
14:00:35 â”‚ Frontend rafraÃ®chit (auto)
         â”‚
14:00:35 â”‚ Admin voit le statut changÃ©:
         â”‚ â”œâ”€ Badge vert: "Completed"
         â”‚ â””â”€ Message: "TraitÃ© le 14:00:33"
         â”‚
14:00:40 â”‚ âœ“ Transaction terminÃ©e avec succÃ¨s
```

---

## Statistiques de Couverture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Aspect         â”‚ Avant   â”‚ AprÃ¨s    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Notifications  â”‚ Aucune  â”‚ 2 types  â”‚
â”‚ Retraits       â”‚ Manuel  â”‚ Auto-UI  â”‚
â”‚ DÃ©pÃ´ts         â”‚ Aucune  â”‚ Auto-UI  â”‚
â”‚ Audit Trail    â”‚ Partiel â”‚ Complet  â”‚
â”‚ Admin Dashboardâ”‚ Basique â”‚ Pro      â”‚
â”‚ Temps RÃ©el     â”‚ 30s     â”‚ 10s      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

